% Checks if the given block is in a loop (flag==0)
% If flag==1, all blocks in the route formed by block lh_block and
% lh_startB are returned, beginning with lh_startB. 
%
% If flag==2, all blocks in the route starting from
% block lh_startB and ending with block lh_block are returned, or, if a block that has no output,
% Note: The difference between flag ==1 and ==2 is that if no route is formed
% by start block lh_startB and end block lh_block, in case flag==1, no
% blocks in the lr_loopblocks will be returned, whereas if flag==2, the blocks from
% start block lh_startB to all other blocks will be returned in lr_loopblocks. If a
% route between the given blocks exists, the results of flag=1 and flag=2 are
% the same.
% 
% If flag==3, it does same as flag==2 but stops when a non-virtual block is
% found as the dst block.
%
% Atomic subsystem is treated as one unit, so that if the atomic subsystem
% is in one loop, all the blocks inside this atomic subsystem are then
% regarded as in this loop too.
% if flag>0, atomic subsystem will not be treated as one unit, and only
% return variable lr_loopblocks is useful.
%
% SYNTAX:
%
% [result,lr_loopblocks,startBlocks]=mes_if_block_in_loop(lh_block,flag,lh_startB,
%         local_search,searchAll,b_reuseableSubsysAsSource,slVirtualBlocks,cs_stop_masktypes)
%
% [n_cached] = mes_if_block_in_loop()
% note: call without arguments, to initiate internal cache
%
%
% INPUT ARGUMENTS:
% ===============
% lh_block-- block handle to be tested, must not be a handle of a From,GOTO,
%            or DataStoreMemory block. It is also the end block if flag=1
% flag    --  = 0: loop test (default): returns true, if block is located in a loop
%             = 1: returns blocks between given startblock and end block lh_block,
%                 if existing.
%             = 2: returns routes beginning with lh_startB and ending either
%                 with block lh_block or any terminal block (block without output)
%             = 3: same as ==2, but stops if a nonvirtual block, as given in 
%                 argument slVirtualBlocks, is found.
%             = 4: same as 3, but stops at reusable subsystem
%
% lh_startB -- if flag>=1, will search all the blocks from block lh_startB to
%              block lh_block. not used, it flag==0.
% local_search -- descr. tbd
% searchAll -- descr. tbd
% b_reuseableSubsysAsSource -- descr. tbd
% slVirtualBlocks -- blocks that stop the search.
% cs_stop_masktypes -- cell array of mask types, if such block is met, the
% search will stop
%
%
% RETURN VARIABLES:
% ================
% result -- if block is in loop, ==1, otherwise, ==0
% lr_loopblocks --  array of struct, all blocks and ports that form the loop.
%           fields:
%             lh_block---handle of block in the loop
%             lh_outport--the handle of the outport of block lh_block
%             lh_dstport--handle of the inport of the dst block
%             b_dstBisNonvirtual---
% startBlocks--array of block handles, which is the start point of the
%             found lr_loopblocks. One block maybe in more than one lr_loopblocks, in
%             variable lr_loopblocks all the blocks that form the the lr_loopblocks are
%             given, this variable tells that which block is the start
%             point of a loop. Normally the start point of a loop is block
%             lh_block, but if lh_block is in an atomic subsystem, and the
%             atomic subsystem is in a loop, then the lh_block is regarded
%             as in the loop too, in this case, the start point is then the
%             atomic subsystem.
% local_search--if ==true, then search only in the parent of the lh_block,
% if ==false, search in the whole model. E.g if ==true, and the lh_block is
% in a loop formed by blocks outside the parent of lh_block, then this
% function will not show that lh_block is in a loop, if ==false, then it is
% reported in a loop.
% searchAll--if == true, search all the loop branchs that this block
% resides in.
% b_reuseableSubsysAsSource-- if true, then a reuseable subsystem is
% considered as a souce. default is false
% n_cached: number of cached busselector structs
%           returned, if called without arguments
% 
% Example:
%       following example will check if given block is in a loop and return
%       the blocks that form the loop in lr_loopblocks and the start point in
%       startBlocks
%       [result,lr_loopblocks,startBlocks]=mes_if_block_in_loop(gcbh);
%       following example will return all the blocks formed the route from
%       block gcbh to block lh_endB 
%       [result,lr_loopblocks,startBlocks]=mes_if_block_in_loop(lh_endB,1,gcbh);
%
% ***********************************************************
% Copyright:    Model Engineering Solutions
% Date:         $Date: 2020/07/31 16:10:17CEST $
% Version:      $Rev: 6318 $
% ***********************************************************

function [result,lr_loopblocks,startBlocks]=mes_if_block_in_loop(lh_block,flag, ...
                                           lh_startB,local_search,searchAll,...
                                          b_reuseableSubsysAsSource,slVirtualBlocks,cs_stop_masktypes)



































































































































































































































































































































































































































































































































































































































































































































































































































































































































































